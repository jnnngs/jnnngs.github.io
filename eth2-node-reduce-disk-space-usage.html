<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Reduce GETH ETH Node Disk Space Usage - jnnngs</title><meta name="description" content="So, I have a ETH2 validator node which uses a Hetzner AX41 dedicated server and has been running since genesis. The set-up includes a GETH ETH1 node, beacon chain and the ETH2 Validator (Prysm) and is slowly using the allocated 1TB NVMe disk space (2&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://jnnn.gs/eth2-node-reduce-disk-space-usage.html"><link rel="alternate" type="application/atom+xml" href="https://jnnn.gs/feed.xml"><link rel="alternate" type="application/json" href="https://jnnn.gs/feed.json"><meta property="og:title" content="Reduce GETH ETH Node Disk Space Usage"><meta property="og:site_name" content="jnnngs"><meta property="og:description" content="So, I have a ETH2 validator node which uses a Hetzner AX41 dedicated server and has been running since genesis. The set-up includes a GETH ETH1 node, beacon chain and the ETH2 Validator (Prysm) and is slowly using the allocated 1TB NVMe disk space (2&hellip;"><meta property="og:url" content="https://jnnn.gs/eth2-node-reduce-disk-space-usage.html"><meta property="og:type" content="article"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--logo-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--menu-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}</style><link rel="stylesheet" href="https://jnnn.gs/assets/css/style.css?v=2405d04b119f74cf51b884beb85eb424"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://jnnn.gs/eth2-node-reduce-disk-space-usage.html"},"headline":"Reduce GETH ETH Node Disk Space Usage","datePublished":"2021-03-26T15:02","dateModified":"2021-03-27T11:26","description":"So, I have a ETH2 validator node which uses a Hetzner AX41 dedicated server and has been running since genesis. The set-up includes a GETH ETH1 node, beacon chain and the ETH2 Validator (Prysm) and is slowly using the allocated 1TB NVMe disk space (2&hellip;","author":{"@type":"Person","name":"Jnnngs"},"publisher":{"@type":"Organization","name":"Jnnngs"}}</script></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://jnnn.gs/">jnnngs</a></header><main><article class="post"><div class="hero"><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2021-03-26T15:02">March 26, 2021</time></div><h1>Reduce GETH ETH Node Disk Space Usage</h1></div></header></div><div class="wrapper post__entry"><p>So, I have a ETH2 validator node which uses a Hetzner AX41 dedicated server and has been running since genesis. The set-up includes a GETH ETH1 node, beacon chain and the ETH2 Validator (Prysm) and is slowly using the allocated 1TB NVMe disk space (2 x 512GB using RAID 0). I reached out to the Prysm Discord channel to seek advice and what is best to do. A very friendly mod replied and I thought it useful to share in ase anyone else has the same challenge.</p><p>I'm planning to go with option 1, as I already have infura failover configured. Another option is to add 2 x more NVMe disks from Hetzner and then add them to the OS. This would mean 20 minutes downtime, so an option for future need.</p><p> </p><div id="chat-messages-825015216634593311" class="message-2qnXI6 cozyMessage-3V1Y8y wrapper-2a6GCs cozy-3raOZG zalgo-jN1Ica" tabindex="-1" role="listitem" data-list-item-id="chat-messages___chat-messages-825015216634593311"><div class="contents-2mQqc9" role="document"><div class="markup-2BOw-j messageContent-2qWWxC"><span style="color: #2dc26b;">1) Configure a failover eth1 - infura free or alchemy free - then offline snapshot prune geth. This requires 50 GiB free. If you have 25 GiB free, we have reports of it failing; more than 25 and less than 50, I guess you will be our guinea pig! Stop geth, and, as the user that geth runs at in production, do a snapshot prune. If geth runs in systemd, it might look like this: <code class="inline">tmux</code> so the prune doesn't get killed early, and then <code class="inline">sudo systemctl stop geth</code> and then <code class="inline">sudo -u GETHUSER geth --datadir /my/data/dir snapshot prune-state</code>. That will take about 4 hours, and then Geth will be back down to around 350 GiB used. The data dir and user will be recorded in <code class="inline">/etc/system/systemd/geth.service</code>, again assuming systemd and <code class="inline">geth</code> as the service name. If you are using eth2-docker, it's even easier; and I assume similar for stefa2k's docker tools. For eth2-docker: <code class="inline">docker-compose stop eth1 &amp;&amp; docker-compose rm eth1</code>, followed by <code class="inline">docker-compose run -d eth1 snapshot prune-state</code>. You can use <code class="inline">docker-compose logs -f eth1</code> to watch it, and when it's done, <code class="inline">docker-compose up -d eth1</code>.</span></div><div> </div><div class="markup-2BOw-j messageContent-2qWWxC"><span style="color: #2dc26b;">2) Stop using geth and rely on infura free with alchemy free failover, or vice versa. This works remarkably well before the consensus upgrade. After the consensus upgrade, running your own geth as an "application client" may be very desirable, but that's at least 9-12 months out.</span></div></div><div class="buttonContainer-DHceWr"><div class="buttons-cl5qTG container-3npvBV" aria-label="Message Actions"><div class="wrapper-2aW0bm"><div class="button-1ZiXG9" tabindex="0" role="button" aria-label="Add Reaction" aria-controls="popout_2378" aria-expanded="false"> </div><div class="button-1ZiXG9" tabindex="0" role="button" aria-label="More" aria-controls="popout_2379" aria-expanded="false"><span style="color: #2dc26b; font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">So choose your adventure: 1) or 2)</span></div><div tabindex="0" role="button" aria-label="More" aria-controls="popout_2379" aria-expanded="false"> </div><div tabindex="0" role="button" aria-label="More" aria-controls="popout_2379" aria-expanded="false"><strong><a href="#INTERNAL_LINK#/post/null">UPDATE</a></strong>:</div><div tabindex="0" role="button" aria-label="More" aria-controls="popout_2379" aria-expanded="false">I came across a Redit post that used method 1 above although via the Geth Service method. This is the approach I followed and it was very simple to implement. Notes below...</div><div tabindex="0" role="button" aria-label="More" aria-controls="popout_2379" aria-expanded="false"> </div><div tabindex="0" role="button" aria-label="More" aria-controls="popout_2379" aria-expanded="false"><h1 style="margin: 0in; font-family: Calibri; font-size: 16.0pt; color: #1e4e79;">Simple way to prune GETH diskspace</h1><h3 style="margin: 0in; font-family: Calibri; font-size: 12.0pt; color: #5b9bd5;">#Check location of working directory</h3><p><code style="margin: 0in; font-family: Consolas; font-size: 11.0pt;">cat /etc/systemd/system/geth.service</code></p><h3 style="margin: 0in; font-family: Calibri; font-size: 12.0pt; color: #5b9bd5;"> </h3><h3 style="margin: 0in; font-family: Calibri; font-size: 12.0pt; color: #5b9bd5;">#Get current size of GETH data location</h3><p><code style="margin: 0in; font-family: Consolas; font-size: 11.0pt;">du -sh &lt;WorkingDirectory&gt;</code></p><p style="margin: 0in; font-family: Calibri; font-size: 11.0pt;"> </p><h3 style="margin: 0in; font-family: Calibri; font-size: 12.0pt; color: #5b9bd5;">#STOP Geth</h3><p><code style="margin: 0in; font-family: Consolas; font-size: 11.0pt;">sudo service geth stop</code></p><p style="margin: 0in; font-family: Calibri; font-size: 11.0pt;"> </p><h3 style="margin: 0in; font-family: Calibri; font-size: 12.0pt; color: #5b9bd5;">#Change Service to Prune</h3><p><code style="margin: 0in; font-family: Consolas; font-size: 11.0pt;">vi /etc/systemd/system/geth.service</code></p><p style="margin: 0in; font-family: Calibri; font-size: 11.0pt;"> </p><h4 style="margin: 0in; font-family: Calibri; font-size: 12.0pt; color: #5b9bd5;"><span style="font-style: italic;">[Comment out existing ExecStart using a #]</span></h4><p><code style="margin: 0in; font-family: Consolas; font-size: 11.0pt;"><strong><span style="color: #fa0000;">#</span></strong>ExecStart=/usr/bin/geth blah blah blah</code></p><p style="margin: 0in; font-family: Calibri; font-size: 11.0pt;"> </p><h4 style="margin: 0in; font-family: Calibri; font-size: 12.0pt; color: #5b9bd5;"><span style="font-style: italic;">[Add new ExecStart to prune]</span></h4><p><code style="margin: 0in; font-family: Consolas; font-size: 11.0pt;">ExecStart=/usr/bin/geth snapshot prune-state</code></p><p style="margin: 0in; font-family: Calibri; font-size: 11.0pt;"> </p><h3 style="margin: 0in; font-family: Calibri; font-size: 12.0pt; color: #5b9bd5;">#Reload Service config</h3><p><code style="margin: 0in; font-family: Consolas; font-size: 11.0pt;">sudo systemctl daemon-reload</code></p><p style="margin: 0in; font-family: Calibri; font-size: 11.0pt;"> </p><h3 style="margin: 0in; font-family: Calibri; font-size: 12.0pt; color: #5b9bd5;">#Start Geth Pruning</h3><p><code style="margin: 0in; font-family: Consolas; font-size: 11.0pt;">Sudo service geth start</code></p><p style="margin: 0in; font-family: Calibri; font-size: 11.0pt;"> </p><h3 style="margin: 0in; font-family: Calibri; font-size: 12.0pt; color: #5b9bd5;">#Check Geth service status</h3><p><code style="margin: 0in; font-family: Consolas; font-size: 11.0pt;">Sudo service geth status</code></p><p><code style="margin: 0in; font-family: Consolas; font-size: 11.0pt;"> </code></p><h3 style="margin: 0in; font-family: Calibri; font-size: 12.0pt; color: #5b9bd5;">#Check Geth service logs for pruning activity</h3><p><code style="margin: 0in; font-family: Consolas; font-size: 11.0pt;">sudo journalctl -fu geth</code></p><p style="margin: 0in; font-family: Calibri; font-size: 11.0pt;"> </p><blockquote style="margin: 0in; font-family: Calibri; font-size: 11.0pt; color: #595959;"><span style="font-style: italic;">Logs should look something like this…</span></blockquote><p style="margin: 0in;"><img loading="lazy" src="file:///C:/Users/jnnngs/AppData/Local/Temp/msohtmlclip1/01/clip_image001.png" data-is-external-image="true" alt="Machine generated alternative text:
797s 
Mar 27 
6881 
681s 
Mar 27 
[03-27 714] 
-mss 
Mar 27 
714] 
471s 
Mar 27 
[03-27 714] 
767s 
Mar 27 
7481 
e Ca=17 ms 
S2s 
Mar 27 
g64s 
Mar 27 
7501 
70ss 
Mar 27 
:44.774] 
531s 
Mar 27 
[03-27 774] 
liss 
Mar 27 
467s 
Mar 27 
723s 
12. 
. 02 
12:02 : 52 
44 
gech[86g221] • 
gech[86g221] • 
gech[86g221] • 
gech[86g221] • 
gech[86g221] • 
gech[86g221] • 
gech[86g221] • 
gech[86g221] • 
gech[86g221] • 
gech[86g221] • 
gech[86g221] • 
INFO 
INFO 
INFO 
INFO 
INFO 
INFO 
INFO 
INFO 
INFO 
INFO 
INFO 
[03-27 | 12 
: 02 
runzng 
Pruning 
Pruning 
Pruning 
Pruning 
Pruning 
Pruning 
Pruning 
Pruning 
Pruning 
Pruning 
state 
st ace 
state 
state 
state 
state 
state 
state 
state 
state 
state 
data 
dac a 
dac a 
dac a 
dac a 
dac a 
dac a 
dac a 
dac a 
dac a 
dac a 
node s — 
—57183086 
node s — 
—60211201 
node s — 
—63337230 
node s — 
—66426sog 
node s — 
—69427201 
node s — 
—72568030 
node s — 
—75739291 
node s — 
—78848001 
node s — 
—81894285 
node s — 
—85016212 
node s — 
—88166401 
—IS . 83GiB 
s 1 ze— 
—16. 67GiB 
s 1 ze— 
—17 . S3GiB 
s 1 ze— 
—18 . 39GiB 
s 1 ze— 
—lg .22GiB 
s 1 ze— 
—20 . ogGiB 
s 1 ze— 
—20 . g7GiB 
s 1 ze— 
—21 . 83GiB 
s 1 ze— 
—22 . 67GiB 
s 1 ze— 
—23 . S3GiB 
s 1 ze— 
—24 . 41GiB 
s 1 ze— 
elapsed 
elapsed 
elapsed 
elapsed 
elapsed 
elapsed 
elapsed 
elapsed 
elapsed 
elapsed 
elapsed 
=2m24 . 073s 
=2m32 . oggs 
=2m40 . oggs 
=2m48 . oggs 
=2mS6. 133s 
=3m4 . 13Ss 
=3m12 . 13Ss 
=3m20 . Isgs 
=3m28 . 160s 
=3m36. 160s 
=3m44 .22gs 
17m2g. 
eta 
—17m24. 
—17m17 . 
—17m10. 
e Ca=16mS 7 
—16m4g . 
—16m42 . 
e Ca=16m36 
e Ca=16m28 
e Ca=16m20 " width="829" height="260"></p><p style="margin: 0in; font-family: Calibri; font-size: 11.0pt;"> </p><p><cite style="margin: 0in; font-family: Calibri; font-size: 9.0pt; color: #595959;"> </cite><span style="font-style: italic;">Once pruning is finished,</span></p><ol style="margin-left: .375in; direction: ltr; unicode-bidi: embed; margin-top: 0in; margin-bottom: 0in; font-family: Calibri; font-size: 11.0pt; font-weight: normal; font-style: normal;" type="1"><li style="margin-top: 0; margin-bottom: 0; vertical-align: middle;" value="1"><span style="font-family: Calibri; font-size: 11.0pt; font-weight: normal; font-style: normal;">Stop Geth</span></li><li style="margin-top: 0; margin-bottom: 0; vertical-align: middle;"><span style="font-family: Calibri; font-size: 11.0pt;">Change Service ExecStart back to original config (comment out Prune line and uncomment original one)</span></li><li style="margin-top: 0; margin-bottom: 0; vertical-align: middle;"><span style="font-family: Calibri; font-size: 11.0pt;">Reload Service config</span></li><li style="margin-top: 0; margin-bottom: 0; vertical-align: middle;"><span style="font-family: Calibri; font-size: 11.0pt;">Start Geth</span></li><li style="margin-top: 0; margin-bottom: 0; vertical-align: middle;"><span style="font-family: Calibri; font-size: 11.0pt;">Check Service status</span></li><li style="margin-top: 0; margin-bottom: 0; vertical-align: middle;"><span style="font-family: Calibri; font-size: 11.0pt;">Check Geth logs</span></li><li>Check Geth working directory size again</li></ol><p style="margin: 0in; font-family: Calibri; font-size: 11.0pt;"> </p><p style="margin: 0in; font-family: Calibri; font-size: 11.0pt;">Boom!</p></div></div></div></div></div></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on March 27, 2021</p><div class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fjnnn.gs%2Feth2-node-reduce-disk-space-usage.html" class="js-share facebook" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://jnnn.gs/assets/svg/svg-map.svg#facebook"/></svg> <span>Facebook</span> </a><a href="https://twitter.com/share?url=https%3A%2F%2Fjnnn.gs%2Feth2-node-reduce-disk-space-usage.html&amp;via=%40jnnngs&amp;text=Reduce%20GETH%20ETH%20Node%20Disk%20Space%20Usage" class="js-share twitter" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://jnnn.gs/assets/svg/svg-map.svg#twitter"/></svg> <span>Twitter</span> </a><a href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Fjnnn.gs%2Feth2-node-reduce-disk-space-usage.html&amp;title=Reduce%20GETH%20ETH%20Node%20Disk%20Space%20Usage" class="js-share linkedin" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://jnnn.gs/assets/svg/svg-map.svg#linkedin"/></svg> <span>LinkedIn</span> </a><a href="https://api.whatsapp.com/send?text=Reduce%20GETH%20ETH%20Node%20Disk%20Space%20Usage https%3A%2F%2Fjnnn.gs%2Feth2-node-reduce-disk-space-usage.html" class="js-share whatsapp" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://jnnn.gs/assets/svg/svg-map.svg#whatsapp"/></svg> <span>WhatsApp</span></a></div><div class="post__bio bio"><div class="bio__info"><h3 class="bio__name"><a href="https://jnnn.gs/authors/paul-jennings/" class="invert" rel="author">Jnnngs</a></h3></div></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://jnnn.gs/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://jnnn.gs/when-to-use-vnet-peering-vs-vpn-gateway-on-azure.html" class="invert post__nav-link" rel="prev"><span>Previous</span> When to use VNet Peering vs VPN Gateway on Azure</a></div></div></nav></main><footer class="footer"><div class="footer__copyright"><p>jnnn.gs © 2021</p></div><button class="footer__bttop js-footer__bttop" aria-label="Back to top"><svg><title>Back to top</title><use xlink:href="https://jnnn.gs/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.top',
   };</script><script defer="defer" src="https://jnnn.gs/assets/js/scripts.min.js?v=f4c4d35432d0e17d212f2fae4e0f8247"></script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>
<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Architecture for AWS VPC: Internet-facing Public subnet with Private subnet backend - jnnngs</title><meta name="description" content=" What is it? An Amazon Virtual Private Cloud (Amazon VPC) is one of the fundamental architectures and part of many 'typical' AWS designs. Its implementation covers a lot of best practices and provides a highly secure environment for solutions that require public-facing access with&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://jnnn.gs/architecture-for-aws-vpc-internet-facing-public-subnet-with-private-subnet-backend.html"><link rel="alternate" type="application/atom+xml" href="https://jnnn.gs/feed.xml"><link rel="alternate" type="application/json" href="https://jnnn.gs/feed.json"><meta property="og:title" content="Architecture for AWS VPC: Internet-facing Public subnet with Private subnet backend"><meta property="og:site_name" content="jnnngs"><meta property="og:description" content=" What is it? An Amazon Virtual Private Cloud (Amazon VPC) is one of the fundamental architectures and part of many 'typical' AWS designs. Its implementation covers a lot of best practices and provides a highly secure environment for solutions that require public-facing access with&hellip;"><meta property="og:url" content="https://jnnn.gs/architecture-for-aws-vpc-internet-facing-public-subnet-with-private-subnet-backend.html"><meta property="og:type" content="article"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--logo-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--menu-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}</style><link rel="stylesheet" href="https://jnnn.gs/assets/css/style.css?v=2405d04b119f74cf51b884beb85eb424"><link rel="stylesheet" href="https://jnnn.gs/assets/css/photoswipe.css?v=7331f6eb15671b2fc8e3ffd46e849f7b"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://jnnn.gs/architecture-for-aws-vpc-internet-facing-public-subnet-with-private-subnet-backend.html"},"headline":"Architecture for AWS VPC: Internet-facing Public subnet with Private subnet backend","datePublished":"2021-12-21T12:08","dateModified":"2021-12-22T11:01","description":" What is it? An Amazon Virtual Private Cloud (Amazon VPC) is one of the fundamental architectures and part of many 'typical' AWS designs. Its implementation covers a lot of best practices and provides a highly secure environment for solutions that require public-facing access with&hellip;","author":{"@type":"Person","name":"Jnnngs"},"publisher":{"@type":"Organization","name":"Jnnngs"}}</script><style>.pswp--svg .pswp__button,
				          .pswp--svg .pswp__button--arrow--left:before,
				          .pswp--svg .pswp__button--arrow--right:before {
					          background-image: url(https://jnnn.gs/assets/svg/gallery-icons-light.svg);
			              }</style></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://jnnn.gs/">jnnngs</a></header><main><article class="post"><div class="hero"><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2021-12-21T12:08">December 21, 2021</time></div><h1>Architecture for AWS VPC: Internet-facing Public subnet with Private subnet backend</h1></div></header></div><div class="wrapper post__entry"><figure class="post__image post__image--center"><img loading="lazy" src="https://jnnn.gs/media/posts/21/AWS_Public_Private_Subnet_with_Security_picture_only.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://jnnn.gs/media/posts/21/responsive/AWS_Public_Private_Subnet_with_Security_picture_only-xs.png 300w, https://jnnn.gs/media/posts/21/responsive/AWS_Public_Private_Subnet_with_Security_picture_only-sm.png 480w, https://jnnn.gs/media/posts/21/responsive/AWS_Public_Private_Subnet_with_Security_picture_only-md.png 768w, https://jnnn.gs/media/posts/21/responsive/AWS_Public_Private_Subnet_with_Security_picture_only-lg.png 1024w, https://jnnn.gs/media/posts/21/responsive/AWS_Public_Private_Subnet_with_Security_picture_only-xl.png 1360w, https://jnnn.gs/media/posts/21/responsive/AWS_Public_Private_Subnet_with_Security_picture_only-2xl.png 1600w" alt="AWS VPC - Typical Design" width="752" height="504"></figure><h2>What is it?</h2><p>An Amazon Virtual Private Cloud (Amazon VPC) is one of the fundamental architectures and part of many "typical" AWS designs. Its implementation covers a lot of best practices and provides a highly secure environment for solutions that require public-facing access with securely protected backends. </p><h2>Blog post</h2><p>This blog post was created with a primary reason to support my AWS Architecture Certification (I passed!) and as a secondary purpose as a future reference. This post will cover the basic design concepts with basic implementation notes so that the VPC environment can be recreated.</p><p>The main system architecture picture at the top of this post has reference numbers against the core components of the VPC, which are used to provide meaningful information of their purpose. At the bottom of this post, I have provided a rich diagram, which includes all the information needed to be used as a cheat-sheet reference diagram.</p><h2>System Architecture References</h2><ol><li><strong>VPC</strong>: Virtual Private Cloud provides a secure network for your cloud components. Creating a VPC also makes a Route Table, Network ACL, and Network Security Group. The following components are automatically created as part of the VPC creation.<ol style="list-style-type: lower-alpha;"><li>[1a] <strong>Router</strong>: The Router is a logical component to which Route Tables belong to. The Router can not be accessed within the AWS console or command</li><li>[1b] <strong>Route Table</strong>: Each subnet must be associated with a routeing table, which specifies the allowed routes for outbound traffic leaving the subnet</li><li>[1c] <strong>Network ACL: </strong>Virtual firewall for the subnet. By default, everything is allowed for the default ACL, whilst custom ACLs are blocked by default. Network ACLs are stateless meaning explicit inbound and outbound rules are needed</li><li>[1d] <strong>Network Security Group:</strong> Virtual firewall for the EC2 instance. By default, everything is blocked and NSGs are stateful</li></ol></li><li><strong>Subnet</strong>: A subnet is a range of IP addresses in part of your VPC. The provided IPv4 CIDR block specifies how many IPs are available. Depending on the configuration, the subnet can be Public, Private or VPN-only. NB: One subnet in one AZ i.e. can not span multi-AZ</li><li><strong>Internet Gateway</strong>: An internet gateway connects a VPC to the internet. There can only be one internet gateway per VPC </li><li><strong>NAT Gateway</strong>: You can use a NAT gateway so that instances in a private subnet can connect to services outside your VPC, but external services cannot initiate a connection with those instances. NB: NAT Gateways are placed within the public subnet with a VPC Route Table entry to direct 0.0.0.0/0 traffic to the NAT Gateway</li></ol><h2>Implementation Notes</h2><ol><li><strong>Subnet</strong>: Modify auto-assign public IP address to Enabled for the Public subnet</li><li><strong style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit;">Internet Gateway</strong><span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">: Once created, select the gateway and attach to the VPC</span></li><li><strong style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit;">Route Tables</strong><span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">: Once the internet gateway has been created and attached to the VPC, create a new Route Table for routing the public subnet internet traffic. Select the new route table, edit routes, and add a route for 0.0.0.0/0 and target to the internet gateway. Then associate the Public subnet with the new internet outbound route table. NB: The private subnet will continue to use the MAIN route table which was automatically created when creating the VPC</span></li><li><strong style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit;">Public EC2</strong><span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">: Create EC2 instance in custom VPC, Public subnet with tag name as "webServer". Create a new security group (WebDMZ). Add rule for HTTP 0.0.0.0/0</span></li><li><strong style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit;">Private EC2</strong><span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">: Create EC2 instance in custom VPC, Private subnet with tag name as "dbServer". Create a new security group (dbSG), an add an inbound rule for SSH source 10.0.1.0/24 (Public subnet CIDR), MYSQL/Aurora source 10.0.1.0/24 (Public subnet CIDR)</span></li><li><strong style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit;">NGINX</strong><span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">: SSH into the webserver, sudo su, yum update -y (this will confirm outbound internet access), yum install nginx -y</span></li><li><strong style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit;">KeyPair for SSH</strong><span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">: vi myKP.pem, paste KP, save, chmod 400 myKP.pem, ssh ec2-user@IPADDRESS_dbServer. At this point, dbServer has no internet access so we need to implement a NAT Gateway for all internet outbound traffic</span></li><li><strong style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit;">NAT Gateway</strong><span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">: Create a NAT Gateway within your VPC, assign it to the public subnet and add Elastic IP. Edit the MAIN Route Table, add a route for 0.0.0.0/0 to a target of the NAT Gateway. This will now direct outbound internet traffic from the private subnet to the NAT Gateway. Inbound internet traffic will remain blocked</span></li></ol><h2>Cheat-sheet reference diagram</h2><div class="gallery-wrapper"><div class="gallery" data-is-empty="false" data-columns="1"><figure class="gallery__item"><a href="https://jnnn.gs/media/posts/21/gallery/AWS_Public_Private_Subnet_with_Security.png" data-size="1210x886"><img loading="lazy" src="https://jnnn.gs/media/posts/21/gallery/AWS_Public_Private_Subnet_with_Security-thumbnail.png" alt="" width="720" height="527"></a></figure></div></div></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on December 22, 2021</p><ul class="post__tag"><li><a href="https://jnnn.gs/tags/aws/">AWS</a></li><li><a href="https://jnnn.gs/tags/devops/">DevOps</a></li></ul><div class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fjnnn.gs%2Farchitecture-for-aws-vpc-internet-facing-public-subnet-with-private-subnet-backend.html" class="js-share facebook" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://jnnn.gs/assets/svg/svg-map.svg#facebook"/></svg> <span>Facebook</span> </a><a href="https://twitter.com/share?url=https%3A%2F%2Fjnnn.gs%2Farchitecture-for-aws-vpc-internet-facing-public-subnet-with-private-subnet-backend.html&amp;via=%40jnnngs&amp;text=Architecture%20for%20AWS%20VPC%3A%20Internet-facing%20Public%20subnet%20with%20Private%20subnet%20backend" class="js-share twitter" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://jnnn.gs/assets/svg/svg-map.svg#twitter"/></svg> <span>Twitter</span> </a><a href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Fjnnn.gs%2Farchitecture-for-aws-vpc-internet-facing-public-subnet-with-private-subnet-backend.html&amp;title=Architecture%20for%20AWS%20VPC%3A%20Internet-facing%20Public%20subnet%20with%20Private%20subnet%20backend" class="js-share linkedin" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://jnnn.gs/assets/svg/svg-map.svg#linkedin"/></svg> <span>LinkedIn</span> </a><a href="https://api.whatsapp.com/send?text=Architecture%20for%20AWS%20VPC%3A%20Internet-facing%20Public%20subnet%20with%20Private%20subnet%20backend https%3A%2F%2Fjnnn.gs%2Farchitecture-for-aws-vpc-internet-facing-public-subnet-with-private-subnet-backend.html" class="js-share whatsapp" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://jnnn.gs/assets/svg/svg-map.svg#whatsapp"/></svg> <span>WhatsApp</span></a></div><div class="post__bio bio"><div class="bio__info"><h3 class="bio__name"><a href="https://jnnn.gs/authors/paul-jennings/" class="invert" rel="author">Jnnngs</a></h3></div></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://jnnn.gs/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://jnnn.gs/add-additional-teleport-nodes.html" class="invert post__nav-link" rel="prev"><span>Previous</span> Add additional Teleport nodes</a></div></div></nav><div class="post__related related"><div class="wrapper"><h2 class="h5 related__title">You should also read:</h2><article class="related__item"><div class="feed__meta"><time datetime="2021-10-28T10:41" class="feed__date">October 28, 2021</time></div><h3 class="h1"><a href="https://jnnn.gs/portainer-agent-updating-with-watchtower.html" class="invert">Portainer agent updating with watchtower</a></h3></article><article class="related__item"><div class="feed__meta"><time datetime="2021-01-15T09:19" class="feed__date">January 15, 2021</time></div><h3 class="h1"><a href="https://jnnn.gs/azure-private-endpoints-vs-service-endpoints.html" class="invert">Azure Private Endpoints Vs Service Endpoints</a></h3></article><article class="related__item"><div class="feed__meta"><time datetime="2021-01-08T17:07" class="feed__date">January 8, 2021</time></div><h3 class="h1"><a href="https://jnnn.gs/how-to-configure-multiple-domains-with-nginx.html" class="invert">How to configure Multiple Domains with Nginx</a></h3></article></div></div></main><footer class="footer"><div class="footer__copyright"><p>jnnn.gs © 2021</p></div><button class="footer__bttop js-footer__bttop" aria-label="Back to top"><svg><title>Back to top</title><use xlink:href="https://jnnn.gs/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.top',
   };</script><script defer="defer" src="https://jnnn.gs/assets/js/scripts.min.js?v=f4c4d35432d0e17d212f2fae4e0f8247"></script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><script defer="defer" src="https://jnnn.gs/assets/js/photoswipe.min.js?v=b586a3bc288c989ecce7b81b48e35855"></script><script defer="defer" src="https://jnnn.gs/assets/js/photoswipe-ui-default.min.js?v=9952f77ca2b8fbc9449a268008ea8dee"></script><script>var initPhotoSwipeFromDOM=function(gallerySelector){var parseThumbnailElements=function(el){var thumbElements=el.childNodes,numNodes=thumbElements.length,items=[],figureEl,linkEl,size,item;for(var i=0;i<numNodes;i++){figureEl=thumbElements[i];if(figureEl.nodeType!==1){continue;}
          linkEl=figureEl.children[0];size=linkEl.getAttribute('data-size').split('x');item={src:linkEl.getAttribute('href'),w:parseInt(size[0],10),h:parseInt(size[1],10)};if(figureEl.children.length>1){item.title=figureEl.children[1].innerHTML;}
          if(linkEl.children.length>0){item.msrc=linkEl.children[0].getAttribute('src');}
          item.el=figureEl;items.push(item);}
          return items;};var closest=function closest(el,fn){return el&&(fn(el)?el:closest(el.parentNode,fn));};var onThumbnailsClick=function(e){e=e||window.event;e.preventDefault?e.preventDefault():e.returnValue=false;var eTarget=e.target||e.srcElement;var clickedListItem=closest(eTarget,function(el){return(el.tagName&&el.tagName.toUpperCase()==='FIGURE');});if(!clickedListItem){return;}
          var clickedGallery=clickedListItem.parentNode,childNodes=clickedListItem.parentNode.childNodes,numChildNodes=childNodes.length,nodeIndex=0,index;for(var i=0;i<numChildNodes;i++){if(childNodes[i].nodeType!==1){continue;}
          if(childNodes[i]===clickedListItem){index=nodeIndex;break;}
          nodeIndex++;}
          if(index>=0){openPhotoSwipe(index,clickedGallery);}
          return false;};var photoswipeParseHash=function(){var hash=window.location.hash.substring(1),params={};if(hash.length<5){return params;}
          var vars=hash.split('&');for(var i=0;i<vars.length;i++){if(!vars[i]){continue;}
          var pair=vars[i].split('=');if(pair.length<2){continue;}
          params[pair[0]]=pair[1];}
          if(params.gid){params.gid=parseInt(params.gid,10);}
          return params;};var openPhotoSwipe=function(index,galleryElement,disableAnimation,fromURL){var pswpElement=document.querySelectorAll('.pswp')[0],gallery,options,items;items=parseThumbnailElements(galleryElement);options={galleryUID:galleryElement.getAttribute('data-pswp-uid'),getThumbBoundsFn:function(index){var thumbnail=items[index].el.getElementsByTagName('img')[0],pageYScroll=window.pageYOffset||document.documentElement.scrollTop,rect=thumbnail.getBoundingClientRect();return{x:rect.left,y:rect.top+pageYScroll,w:rect.width};},
          mainClass:'pswp--dark',
          preload: [1,2],
          hideAnimationDuration:200,
          showAnimationDuration:0,
          bgOpacity: 0.7,
          showHideOpacity:true,
          closeOnScroll: true,
          arrowKeys: true,
          closeEl: true,
          captionEl: true,
          fullscreenEl: true,
          zoomEl: true,
          shareEl: true,
          counterEl: true,
          arrowEl: true,
          preloaderEl: true
          };if(fromURL){if(options.galleryPIDs){for(var j=0;j<items.length;j++){if(items[j].pid==index){options.index=j;break;}}}else{options.index=parseInt(index,10)-1;}}else{options.index=parseInt(index,10);}
          if(isNaN(options.index)){return;}
          if(disableAnimation){options.showAnimationDuration=0;}
          gallery=new PhotoSwipe(pswpElement,PhotoSwipeUI_Default,items,options);gallery.init();gallery.options.escKey=true;};var galleryElements=document.querySelectorAll(gallerySelector);for(var i=0,l=galleryElements.length;i<l;i++){galleryElements[i].setAttribute('data-pswp-uid',i+1);galleryElements[i].onclick=onThumbnailsClick;}
          var hashData=photoswipeParseHash();if(hashData.pid&&hashData.gid){openPhotoSwipe(hashData.pid,galleryElements[hashData.gid-1],true,true);}};initPhotoSwipeFromDOM('.gallery');</script><div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button><button class="pswp__button pswp__button--share" title="Share"></button><button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button><button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button><button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></body></html>